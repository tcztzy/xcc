# TODO

This file tracks remaining work toward a production-ready C11 compiler. It includes both frontend and backend scope, but only the frontend section is expanded for now.

## 0. Milestone View

- [ ] M0: Complete C11 frontend conformance baseline.
- [ ] M1: Add minimal IR and code generation for macOS arm64.
- [ ] M2: Add Linux/ELF backend path (mold + glibc/musl).
- [ ] M3: Compile CPython core with no source modifications.
- [ ] M4: Harden diagnostics, compatibility, and performance.

## 1. Frontend (Expanded)

### 1.1 Preprocessor Conformance

- [ ] Close remaining C11 edge cases for macro replacement order and rescanning behavior.
- [x] Iteration 3: tighten conditional expression evaluation parity for `#if` / `#elif` boolean short-circuit corner cases.
- [x] Add `__has_include("...")` / `__has_include(<...>)` conditional support with regression tests.
- [ ] Expand include behavior coverage (path search precedence, diagnostics consistency, mapping interaction).
- [ ] Validate predefined macro behavior against C11 and target assumptions.
- [ ] Add curated fixture cases for every preprocessor diagnostic path.

### 1.2 Lexer Completeness

- [ ] Audit tokenization parity for all C11 literal forms and suffix combinations.
- [ ] Tighten UCN/escape handling in edge cases and ensure diagnostic stability.
- [ ] Expand tests for translation phases interaction (trigraphs + line splicing + comments + literals).
- [ ] Ensure strict/gnu mode split is consistent for extension-sensitive tokens.

### 1.3 Parser Grammar Coverage

- [ ] Remove remaining "unsupported" declarator/array-size parse paths where C11 requires support.
- [ ] Finish full declarator coverage for function pointers, parameter arrays, qualifiers, and nested forms.
- [ ] Complete initialization grammar parity (designators, nested initializer lists, mixed forms).
- [ ] Validate all statement/expression grammar branches against curated fixture corpus.
- [ ] Add targeted negative tests for grammar ambiguity and recovery diagnostics.

### 1.4 Type System Model

- [ ] Implement first-class qualifier model (top-level vs nested qualifiers across all derived types).
- [ ] Complete atomic/qualified/derived type composition rules.
- [ ] Ensure complete/incomplete type transitions are modeled consistently (records, arrays, enums).
- [ ] Normalize type identity/equivalence rules used by parser, sema, and `_Generic` selection.

### 1.5 Semantic Analysis and Conversions

- [ ] Remove remaining `Unsupported statement` / `Unsupported expression` paths by implementing required branches.
- [ ] Complete usual arithmetic conversions and integer promotions for all C11 combinations.
- [x] Iteration 1: align compound-assignment conversion rules with C11 arithmetic/integer constraints (`+=`, `-=`, `*=`, `/=`, `%=` and bit/shift assigns).
- [x] Iteration 2: tighten pointer compatibility for subtraction/relational operations across qualified compatible pointee types and reject `void*` arithmetic.
- [x] Iteration 2b: tighten assignment/equality/conditional/call-pointer conversions for nested qualifier mismatches (e.g. `int **` vs `const int **`).
- [ ] Tighten pointer compatibility/conversion rules (assignment, conditional, equality, call arguments).
- [ ] Complete assignment and initialization constraint checks for all object categories.
- [ ] Finish storage-duration/linkage/storage-class rule enforcement (`extern`/`static`/`_Thread_local`, etc.).
- [ ] Expand control-flow validation (`goto` labels, switch/case constraints, function-scope interactions).
- [ ] Verify constant-expression evaluator against enum, case label, and static assertion requirements.

### 1.6 Declarations and Objects

- [ ] Complete `_Alignas` / `_Alignof` rule handling across declaration contexts.
- [ ] Finalize `_Atomic` object/type constraints and diagnostics.
- [ ] Complete record/union member constraints and layout-relevant semantic validation.
- [ ] Ensure function declaration compatibility checks fully match C11 redeclaration rules.

### 1.7 Diagnostics Quality

- [ ] Ensure each semantic/parse/preprocessor rejection path has stable, actionable messages.
- [ ] Standardize source range and stage-tag behavior for all diagnostics.
- [ ] Add regression tests for all known high-risk diagnostics.

### 1.8 Conformance and Regression Testing

- [ ] Expand curated Clang fixture manifest with additional C11 frontend coverage.
- [ ] Add local tests for every gap where no suitable upstream fixture exists.
- [ ] Maintain 100% line + branch coverage while adding new behavior.
- [ ] Keep `tox -e py311`, `tox -e lint`, `tox -e type`, and `tox -e clang_suite` green.

### 1.9 CPython-Driven Gap Closure

- [ ] Start regular frontend-only compilation trials against selected CPython translation units.
- [ ] Record failures into categorized buckets (preprocessor, parser, sema, diagnostics).
- [ ] Convert each bucket item into reproducible unit/fixture tests before implementation.

## 2. Backend and Toolchain (Outline Only)

- [ ] Define IR shape and lowering contract from frontend typed AST.
- [ ] Implement minimal code generation for macOS arm64 object output.
- [ ] Add Mach-O emission + system linker integration.
- [ ] Add Linux/ELF emission path and mold integration.
- [ ] Validate glibc/musl workflows in Docker tox targets.
- [ ] Build backend diagnostics and debug-info strategy.

## 3. Cross-Cutting Engineering

- [ ] Preserve stdlib-only runtime dependency policy.
- [ ] Keep CPython 3.11+ and PyPy 3.11+ compatibility in CI/tox coverage.
- [ ] Track lessons learned in `LESSONS.md` for each major compiler/testing change.
- [ ] Keep docs in sync with implementation status after each milestone.

## Progress Log

- Iteration: `codex/m0-conversion-01`
- Done:
  - Iteration 3 slice: tightened file-scope declaration-analysis diagnostics by making `auto`/`register` storage-class rejections object-declaration-specific (`Invalid storage class for file-scope object declaration: ...`) and making tag-only `_Alignas` failures explicitly object-contextual (`Invalid alignment specifier for file-scope object declaration without identifier`), with focused sema regression coverage for both `register` and `auto` file-scope declarations.
  - Checks: `.venv/bin/python -m unittest tests.test_sema.SemaTests.test_file_scope_invalid_storage_class_error tests.test_sema.SemaTests.test_file_scope_auto_storage_class_error tests.test_sema.SemaTests.test_alignas_tag_only_declaration_error -q` (pass).
  - Checks: `.venv/bin/python -m unittest tests.test_sema -q` (pass).
  - Iteration 3 slice: expanded predefined LP64 target-assumption macros with endian and fundamental-size coverage (`__CHAR_BIT__`, `__SIZEOF_SHORT__`, `__SIZEOF_INT__`, `__SIZEOF_LONG_LONG__`, `__ORDER_LITTLE_ENDIAN__`, `__ORDER_BIG_ENDIAN__`, `__BYTE_ORDER__`) and added regression coverage for expansion plus CLI `-U` behavior.
  - Checks: `.venv/bin/python -m unittest tests.test_preprocessor.PreprocessorTests.test_predefined_standard_macros tests.test_preprocessor.PreprocessorTests.test_cli_undef_removes_predefined_macro -q` (pass).
  - Checks: `.venv/bin/python -m unittest tests.test_preprocessor -q` (pass).
  - Iteration 3 slice: expanded predefined preprocessor target-assumption baseline for LP64 hosts by adding `__LP64__`, `__SIZEOF_POINTER__`, `__SIZEOF_LONG__`, `__SIZE_TYPE__`, and `__PTRDIFF_TYPE__`, with regression coverage for expansion plus CLI `-U` override behavior.
  - Checks: `.venv/bin/python -m unittest tests.test_preprocessor.PreprocessorTests.test_predefined_standard_macros tests.test_preprocessor.PreprocessorTests.test_cli_undef_removes_predefined_macro -q` (pass).
  - Checks: `.venv/bin/python -m unittest tests.test_preprocessor -q` (pass).
  - Iteration 3 slice: made `#line` parsing macro-aware by expanding directive operands before validation, accepting decimal line macros and optional filename-string macros while preserving invalid-directive diagnostics for non-decimal expansions.
  - Checks: `.venv/bin/python -m unittest tests.test_preprocessor.PreprocessorTests.test_line_directive_expands_macro_operands tests.test_preprocessor.PreprocessorTests.test_line_directive_rejects_non_decimal_macro_expansion -q` (pass).
  - Iteration 3 slice: added GNU `#include_next` support in the preprocessor so include search continues after the current include directory (including quoted-include source-dir skipping), while C11 mode keeps rejecting `#include_next` as an unknown directive.
  - Checks: `.venv/bin/python -m unittest tests.test_preprocessor -q` (pass).
  - Iteration 3 slice: refined parser `_Alignas(...)` operand diagnostics by replacing the generic `Invalid alignment specifier` fallback with explicit operand-shape errors for non-object type operands (`_Alignas type operand must denote an object type`), non-ICE expressions, non-positive values, and non-power-of-two values; added focused parser regression coverage, including a dedicated non-ICE `_Alignas(n)` case.
  - Iteration 3 slice: made function `_Thread_local` sema rejections declaration-context-specific by replacing the generic `Invalid declaration specifier` fallback with `Invalid declaration specifier for function declaration: '_Thread_local'` for both prototypes and definitions.
  - Checks: `.venv/bin/python -m unittest tests.test_sema.SemaTests.test_function_thread_local_error tests.test_sema.SemaTests.test_function_definition_thread_local_error -q` (pass).
  - Checks: `.venv/bin/python -m unittest tests.test_sema -q` (pass).
  - Iteration 3 slice: upgraded sema declaration-analysis diagnostics for alignment/identifier failures to be context-specific (file-scope object, block-scope object, file-scope without identifier, block-scope without identifier, and record member declaration) instead of generic `Invalid alignment specifier` / `Expected identifier` fallbacks.
  - Checks: `.venv/bin/python -m unittest tests.test_sema -q` (pass).
  - Next target: audit remaining sema declaration-analysis diagnostics for other context-ambiguous wording and apply the same token-aware/context-aware pattern where behavior is unchanged.
  - Iteration 3 slice: extended `__has_include(...)` condition handling to accept macro-expanded header operands (`#define HDR "x.h"` / `#define HDR <x.h>`), while preserving `Invalid __has_include expression` diagnostics for invalid expansions.
  - Checks: `.venv/bin/python -m unittest tests.test_preprocessor.PreprocessorTests.test_if_expression_with_has_include_macro_expands_to_quoted_header tests.test_preprocessor.PreprocessorTests.test_if_expression_with_has_include_macro_expands_to_angle_header tests.test_preprocessor.PreprocessorTests.test_if_expression_with_has_include_macro_expands_to_invalid_header -q` (pass).
  - Iteration 3 slice: implemented `#pragma once` tracking in the preprocessor so once-marked headers are skipped on subsequent direct and nested includes, with focused regression coverage for repeated includes and wrapper-include scenarios.
  - Checks: `.venv/bin/python -m unittest tests.test_preprocessor.PreprocessorTests.test_pragma_once_skips_second_include tests.test_preprocessor.PreprocessorTests.test_pragma_once_applies_across_nested_includes tests.test_preprocessor -q` (pass).
  - Iteration 3 slice: implemented macro-expanded `#include` target parsing so object-like macros can provide either `"..."` or `<...>` header operands (`#define HDR "inc.h"` / `#define HDR <inc.h>`), with explicit invalid-expansion diagnostics when macro results are not header names.
  - Iteration 3 slice: expanded preprocessor include search + `__has_include` regression coverage for path precedence and nested-include base-dir behavior by adding focused tests for include-vs-system precedence (`#include <...>` and `#include "..."` fallback ordering) plus a nested-header `__has_include("local.h")` case that resolves relative to the including header directory.
  - Checks: `.venv/bin/python -m unittest tests.test_preprocessor -q` (pass).
  - Checks: `.venv/bin/python -m unittest tests.test_preprocessor -q` (pass).
  - Iteration 3 slice: made sema object-declaration storage-class diagnostics context-specific for synthetic `DeclStmt(..., storage_class="typedef")` paths by splitting file-scope and block-scope errors (`Invalid storage class for file-scope object declaration: 'typedef'` vs `Invalid storage class for block-scope object declaration: 'typedef'`).
  - Checks: `.venv/bin/python -m unittest tests.test_sema.SemaTests.test_file_scope_object_declaration_rejects_typedef_storage_class tests.test_sema.SemaTests.test_block_scope_object_declaration_rejects_typedef_storage_class tests.test_sema -q` (pass).
  - Iteration 3 slice: fixed predefined-macro fast-path gating by treating `__DATE__`/`__TIME__` as predefined names, so non-macro lines no longer get retokenized into spaced output when only builtin macros are active; updated preprocessor regressions for include/`__has_include` output-shape expectations and added a focused no-retokenization test.
  - preprocessor predefined standard macro baseline now includes `__STDC_UTF_16__=1` and `__STDC_UTF_32__=1`, with regression coverage for expansion and CLI `-U` removal behavior;
  - preprocessor `#if`/`#elif` now supports `__has_include("...")` and `__has_include(<...>)` with include-path-aware evaluation plus invalid-form diagnostics;
  - predefined macro baseline now includes `__STDC_HOSTED__=1` alongside `__STDC__` / `__STDC_VERSION__`, with regression coverage for expansion behavior;
  - compound assignment accepts arithmetic operands for `*=`, `/=`, `+=`, `-=` and keeps integer-only checks for `%=` / bit/shift assigns;
  - pointer subtraction/relational checks now accept qualified-compatible object pointers and reject `void*` subtraction;
  - assignment/argument/equality/conditional paths now reject nested pointer qualifier promotions such as `int **` to `const int **`;
  - Iteration 3 slice: replaced generic sema fallback `Unsupported expression` for unknown binary operators with operator-specific diagnostics (`Unsupported binary operator: <op>`), while preserving supported `BinaryExpr` analysis paths.
  - Iteration 3 slice: replaced generic sema fallback `Unsupported expression` for unknown unary operators with operator-specific diagnostics (`Unsupported unary operator: <op>`), while preserving supported `UnaryExpr` analysis paths.
  - Iteration 3 slice: removed the implicit assignment-operator fallback in sema by validating compound operators explicitly and emitting `Unsupported assignment operator: <op>` for unknown `AssignExpr.op` values.
  - Iteration 3 slice: removed the implicit update-operator fallback in sema by validating `UpdateExpr.op` and emitting `Unsupported update operator: <op>` for unknown update operators.
  - Iteration 3 slice: replaced the generic sema fallback `Unsupported expression` with node-specific diagnostics (`Unsupported expression node: <ExprClass>`), reducing opaque fallback behavior for unsupported expression AST nodes.
  - Iteration 3 slice: removed the shared shift-family fallback diagnostic (`Binary operator requires integer operands`) by adding operand-specific checks for `<<`/`>>` (`Shift left operand must be integer` / `Shift right operand must be integer`).
  - Iteration 3 slice: replaced the generic statement fallback (`Unsupported statement`) with a node-specific diagnostic (`Unsupported statement node: <StmtClass>`), reducing opaque sema failures for unsupported statement AST nodes.
  - Iteration 3 slice: replaced the generic file-scope declaration fallback (`Unsupported file-scope declaration`) with a node-specific diagnostic (`Unsupported file-scope declaration node: <DeclClass>`), improving unsupported top-level declaration diagnostics.
  - Iteration 3 slice: tightened condition validation by enforcing scalar conditions for `if`/`for`/`while`/`do-while`/`?:` and integer conditions for `switch`, with dedicated diagnostics for non-scalar and non-integer cases.
  - Iteration 3 slice: replaced remaining shared multiplicative/modulo/bitwise operand diagnostics with operator- and side-specific checks (`Multiplication/Division/Modulo/Bitwise <left|right> operand ...`) to reduce ambiguous sema failures.
  - Iteration 3 slice: replaced shared equality/logical scalar-operand diagnostics with side-specific messages (`Equality/Logical <left|right> operand must be scalar`) for clearer sema failures.
  - Iteration 3 slice: tightened unary operand constraints and diagnostics by splitting `+`/`-`/`~` checks (`Unary plus/minus operand must be arithmetic`, `Bitwise not operand must be integer`) and allowing floating unary `+`/`-` results.
  - Iteration 3 slice: replaced shared additive diagnostics with operator-specific messages for `+` and `-`, clarifying pointer/integer and pointer-pointer rejection paths.
  - Iteration 3 slice: improved call diagnostics by including expected/got argument counts and 1-based argument index in type mismatch errors.
  - Iteration 3 slice: replaced update-expression generic mismatch diagnostics with a dedicated operand constraint message (`Update operand must be integer or pointer`).
  - Iteration 3 slice: replaced compound-assignment generic mismatch diagnostics with operator-family-specific messages (additive, multiplicative, and bitwise/shift/modulo assignment constraints).
  - Iteration 3 slice: replaced plain assignment mismatch diagnostics with an explicit compatibility message (`Assignment value is not compatible with target type`).
  - Iteration 3 slice: replaced return mismatch diagnostics with an explicit compatibility message (`Return value is not compatible with function return type`).
  - Iteration 3 slice: split cast rejection diagnostics into target, operand, and overload-selection failures for clearer cast errors.
  - Iteration 3 slice: equality now treats casted null pointer constants (`(void*)0`) as null-pointer-compatible even in pointer-vs-pointer comparisons (including function pointers), while preserving existing incompatible pointer diagnostics.
  - Iteration 3 slice: tightened pointer arithmetic constraints so additive/compound-additive/update expressions reject `void*` and function-pointer arithmetic (`+`, `-`, `+=`, `-=`, `++`, `--`) while preserving object-pointer arithmetic.
  - Iteration 3 slice: split scalar/array/record initializer-list designator diagnostics into shape-specific messages (scalar single-item/designator rules and array/member designator kind requirements).
  - Iteration 3 slice: made preprocessor `#if` expression fallback diagnostics node/operator-specific in both evaluators (preprocessor and integer-expression paths), and added regression assertions for the exact error text.
  - Iteration 3 slice: split generic preprocessor/integer-expression literal fallback diagnostics into literal-type-specific messages and added comparator-shape regression coverage for both evaluators.
  - Iteration 3 slice: split parser generic `Unsupported type` diagnostics into context-specific messages (`Unsupported declaration type` vs `Unsupported type name`) and added parser/fixture coverage updates.
  - Iteration 3 slice: split integer type-specifier fallback diagnostics into specific parser errors for duplicate signedness and invalid keyword ordering, with regression coverage for declaration/type-name contexts.
  - Iteration 3 slice: made duplicate storage-class declaration-specifier diagnostics keyword-specific (`Duplicate storage class specifier: '<keyword>'`) and updated parser regression coverage.
  - Iteration 3 slice: made duplicate thread-local declaration-specifier diagnostics keyword-specific (`Duplicate thread-local specifier: '_Thread_local'`) and updated parser regression coverage.
  - Iteration 3 slice: tightened parameter-array declaration diagnostics by rejecting duplicate array qualifiers (`Duplicate type qualifier: '<keyword>'`) and duplicate `static` bounds (`Duplicate array bound specifier: 'static'`), with parser regression coverage updates.
  - Iteration 3 slice: split generic parser array-size fallback diagnostics into context-specific messages (`Array size is required in this context` and `Array size must be an integer constant expression`) and tightened parser regression assertions for these paths.
  - Iteration 3 slice: replaced the generic static-parameter array-size helper error (`Expected array size`) with a context-specific diagnostic (`Array parameter with 'static' requires a size`) and added focused parser regression coverage.
  - Iteration 3 slice: split array-size integer-literal parse failures into source-shape-specific parser diagnostics (`unsupported integer suffix`, `non-octal digits`, `hex literal requires at least one digit`, `decimal digits required`) and expanded parser regression assertions for helper/declarator paths.
  - Iteration 3 slice: replaced the generic non-VLA array-size constant-expression fallback with expression-node-specific diagnostics (`Array size expression '<ExprClass>' is not an integer constant expression`) and expanded parser regression coverage for malformed literal-token and suffix-only decimal-shape branches.
  - Iteration 3 slice: refined array-size non-ICE diagnostics for cast and conditional expressions by reporting conditional-condition failures directly and unwrapping cast operands to their underlying non-ICE cause, with focused parser regression assertions.
  - Iteration 3 slice: split array-size fallback diagnostics for `sizeof`/`_Alignof` expression forms into dedicated messages (`Array size sizeof expression ...` / `Array size alignof expression ...`) and added focused helper regression coverage.
  - Iteration 3 slice: split array-size non-ICE assignment fallback into a node-specific diagnostic (`Array size assignment expression is not an integer constant expression`) and added focused helper regression coverage.
  - Iteration 3 slice: refined unsupported type-specifier diagnostics by including the offending token text in declaration/type-name contexts (`Unsupported declaration type: '<token>'` / `Unsupported type name: '<token>'`) and updated parser regression assertions.
  - Iteration 3 slice: split unknown-identifier type diagnostics from unsupported-keyword diagnostics (`Unknown declaration type name: '<ident>'` / `Unknown type name: '<ident>'`), and routed generic-association type parsing through type-name context diagnostics.
  - Iteration 3 slice: split unsupported non-keyword type diagnostics into token-category-aware messages (`Unsupported declaration/type name token (<category>): '<token>'`) and route non-keyword parse-type-spec failures through these diagnostics with focused parser coverage.
  - Iteration 3 slice: replaced type-name punctuator token fallbacks with punctuator-specific messages for declarator-shape parse branches (`(` / `[` / `;`) and kept parse acceptance behavior unchanged.
  - Iteration 3 slice: expanded type-name punctuator diagnostics for missing-type association separators (`)` / `,` / `:`), reducing generic `Unsupported type name punctuator` fallbacks in malformed `_Generic` associations.
  - Iteration 3 slice: expanded type-name punctuator diagnostics for additional malformed `_Generic` association separators (`?` / `]` / `}`) and added focused parser regression coverage for each punctuation shape.
  - Iteration 3 slice: replaced remaining type-name token fallback diagnostics for malformed `_Generic` association starts by adding explicit non-punctuator and end-of-input messages (`Type name cannot start with <token-kind>...` / `Type name is missing before end of input`), plus focused parser regression coverage.
  - Iteration 3 slice: replaced declaration-context punctuator fallback diagnostics with punctuator-specific messages (`Declaration type cannot start with ...` / `Declaration type is missing before ...`) and added focused parser regression tests for `(`, `[`, and `;` malformed declaration starts.
  - Iteration 3 slice: added a dedicated declaration-context right-parenthesis diagnostic (`Declaration type is missing before ')'`) to reduce remaining `Unsupported declaration type punctuator` fallback usage, with focused parser regression coverage.
  - Iteration 3 slice: added a dedicated declaration-context `*` diagnostic (`Declaration type is missing before '*': pointer declarator requires a base type`) to reduce generic punctuator fallback usage for malformed pointer-style declaration starts, with focused parser regression coverage.
  - Iteration 3 slice: added a dedicated declaration-context `...` diagnostic (`Declaration type is missing before '...': expected a type specifier`) and parser regression coverage, reducing another `Unsupported declaration type punctuator` fallback path.
  - Iteration 3 slice: mapped `-` punctuator fallbacks in declaration/type-name contexts to explicit diagnostics (`Declaration type is missing before '-'...` / `Type name cannot start with '-'...`) and added focused parser regression coverage.
  - Iteration 3 slice: mapped `/` punctuator fallbacks in declaration/type-name contexts to explicit diagnostics (`Declaration type is missing before '/'...` / `Type name cannot start with '/'...`) and added focused parser regression coverage.
  - Iteration 3 slice: mapped `%` punctuator fallbacks in declaration/type-name contexts to explicit diagnostics (`Declaration type is missing before '%'...` / `Type name cannot start with '%'...`) and added focused parser regression coverage.
  - Iteration 3 slice: mapped `%:` digraph punctuator fallbacks in declaration/type-name contexts to explicit diagnostics (`Declaration type is missing before '%:'...` / `Type name cannot start with '%:'...`) and added focused parser regression coverage.
  - Iteration 3 slice: mapped `%:%:` digraph punctuator fallbacks in declaration/type-name contexts to explicit diagnostics (`Declaration type is missing before '%:%:'...` / `Type name cannot start with '%:%:'...`) and added focused parser regression coverage.
  - Iteration 3 slice: mapped `*` punctuator fallback in type-name contexts to an explicit diagnostic (`Type name cannot start with '*': expected a type specifier`) and added focused parser regression coverage.
  - Iteration 3 slice: mapped `.` and `->` punctuator fallbacks in type-name contexts to explicit diagnostics (`Type name cannot start with '.': ...` / `Type name cannot start with '->': ...`) and added focused parser regression coverage.
  - Iteration 3 slice: mapped `{` punctuator fallback in type-name contexts to an explicit missing-type diagnostic (`Type name is missing before '{'`) and added focused parser regression coverage.
  - Iteration 3 slice: mapped `!` punctuator fallbacks in declaration/type-name contexts to explicit diagnostics (`Declaration type is missing before '!'...` / `Type name cannot start with '!'...`) and added focused parser regression coverage.
  - Iteration 3 slice: mapped `~` punctuator fallbacks in declaration/type-name contexts to explicit diagnostics (`Declaration type is missing before '~'...` / `Type name cannot start with '~'...`) and added focused parser regression coverage.
  - Iteration 3 slice: mapped `&` punctuator fallbacks in declaration/type-name contexts to explicit diagnostics (`Declaration type is missing before '&'...` / `Type name cannot start with '&'...`) and added focused parser regression coverage.
  - Iteration 3 slice: mapped `|` punctuator fallbacks in declaration/type-name contexts to explicit diagnostics (`Declaration type is missing before '|'...` / `Type name cannot start with '|'...`) and added focused parser regression coverage.
  - Iteration 3 slice: mapped `^` punctuator fallbacks in declaration/type-name contexts to explicit diagnostics (`Declaration type is missing before '^'...` / `Type name cannot start with '^'...`) and added focused parser regression coverage.
  - Iteration 3 slice: mapped `=` punctuator fallbacks in declaration/type-name contexts to explicit diagnostics (`Declaration type is missing before '='...` / `Type name cannot start with '='...`) and added focused parser regression coverage.
  - Iteration 3 slice: mapped shift punctuator fallbacks (`<<` / `>>`) in declaration/type-name contexts to explicit diagnostics and added focused parser regression coverage.
  - Iteration 3 slice: mapped compound-assignment punctuator fallbacks (`+=`, `-=`, `*=`, `/=`, `%=` , `&=`, `|=`, `^=`, `<<=`, `>>=`) in declaration/type-name contexts to explicit diagnostics, and added focused parser regression coverage for representative `+=` and `<<=` cases.
  - Iteration 3 slice: expanded parser regression coverage for all remaining compound-assignment punctuator diagnostics in declaration and type-name contexts (`-=`, `*=`, `/=`, `%=` , `&=`, `|=`, `^=`, `>>=`), locking down every mapped token path.
  - Iteration 3 slice: mapped remaining declaration/type-name punctuator fallback diagnostics for preprocessor/digraph tokens (`#`, `##`, `<:`, `:>`, `<%`, `%>`) and added focused parser regression coverage to keep those paths out of generic unsupported-punctuator fallbacks.
  - Iteration 3 slice: added a curated clang-manifest regression case for `#` in declaration type-start position (`int f(#);`) with explicit parse-stage message/position expectations, so external fixture coverage now tracks the hash-specific diagnostic path too.
  - Iteration 3 slice: added a sibling curated clang-manifest regression case for `##` in declaration type-start position (`int f(##);`) with explicit parse-stage message/position expectations, completing hash-token declaration-start coverage in the external fixture suite.
  - Iteration 3 slice: added curated clang-manifest regression coverage for a type-name-start `##` diagnostic path via malformed `_Generic` association (`_Generic(x, ##: 1, default: 0)`), with explicit parse-stage message/position expectations.
  - Iteration 3 slice: added the paired curated clang-manifest regression case for type-name-start `#` in malformed `_Generic` association coverage (`_Generic(x, #: 1, default: 0)`), including explicit parse-stage message/position expectations.
  - Iteration 3 slice: added a curated clang-manifest regression case for the type-name-start `<:` digraph diagnostic path in malformed `_Generic` association coverage (`_Generic(x, <:: 1, default: 0)`), with explicit parse-stage message/position expectations and fixture checksum tracking.
  - Iteration 3 slice: added a curated clang-manifest regression case for the type-name-start `:>` digraph diagnostic path in malformed `_Generic` association coverage (`_Generic(x, :> : 1, default: 0)`), with explicit parse-stage message/position expectations and fixture checksum tracking.
  - Iteration 3 slice: added a curated clang-manifest regression case for the type-name-start `<%` digraph diagnostic path in malformed `_Generic` association coverage (`_Generic(x, <% : 1, default: 0)`), with explicit parse-stage message/position expectations and fixture checksum tracking.
  - Iteration 3 slice: added a curated clang-manifest regression case for declaration type-start `%:` digraph coverage (`int f(%:);`) with explicit parse-stage message/position expectations and fixture checksum tracking.
  - Iteration 3 slice: added a curated clang-manifest regression case for declaration type-start `%:%:` digraph coverage (`int f(%:%:);`) with explicit parse-stage message/position expectations and fixture checksum tracking.
  - Iteration 3 slice: added a curated clang-manifest regression case for declaration type-start `<%` digraph coverage (`int f(<%);`) with explicit parse-stage message/position expectations and fixture checksum tracking.
  - Iteration 3 slice: added a curated clang-manifest regression case for declaration type-start `:>` digraph coverage (`int f(:>);`) with explicit parse-stage message/position expectations and fixture checksum tracking.
  - Iteration 3 slice: added a curated clang-manifest regression case for declaration type-start `<:` digraph coverage in function-parameter context (`int f(<:);`) with explicit parse-stage message/position expectations and fixture checksum tracking.
  - Iteration 3 slice: added a curated clang-manifest regression case for declaration type-start `%>` digraph coverage in a non-parameter declaration context (`%> value;`) with explicit parse-stage message/position expectations and fixture checksum tracking.
  - Iteration 3 slice: added a curated clang-manifest regression case for declaration type-start `:>` digraph coverage in a non-parameter declaration context (`:> value;`) with explicit parse-stage message/position expectations and fixture checksum tracking.
  - Iteration 3 slice: added a curated clang-manifest regression case for declaration type-start `<:` digraph coverage in a non-parameter declaration context (`<: value;`) with explicit parse-stage message/position expectations and fixture checksum tracking.
  - Iteration 3 slice: added a curated clang-manifest regression case for declaration type-start `<%` digraph coverage in a non-parameter declaration context (`<% value;`) with explicit parse-stage message/position expectations and fixture checksum tracking.
  - Iteration 3 slice: added a curated clang-manifest regression case for declaration type-start `%:%:` digraph coverage in a non-parameter declaration context (`%:%: value;`) with explicit parse-stage message/position expectations and fixture checksum tracking.
  - Iteration 3 slice: added a curated clang-manifest regression case for declaration type-start `%:` digraph coverage in a non-parameter declaration context (`%: value;`) with explicit parse-stage message/position expectations and fixture checksum tracking.
  - Iteration 3 slice: added a curated clang-manifest regression case for declaration type-start `%:` digraph coverage in struct-member declaration context (`struct S { %: member; };`), with explicit parse-stage message/position expectations and fixture checksum tracking.
  - Iteration 3 slice: added the paired curated clang-manifest regression case for declaration type-start `%:%:` digraph coverage in struct-member declaration context (`struct S { %:%: member; };`), with explicit parse-stage message/position expectations and fixture checksum tracking.
- Remaining risk: full C11 pointer qualification rules still need structural pointer-level qualifier modeling (current `Type` qualifier representation is base-type-centric).
- Iteration 3 slice: added a curated clang-manifest regression case for declaration type-start `<:` digraph coverage in struct-member declaration context (`struct S { <: member; };`), with explicit parse-stage message/position expectations and fixture checksum tracking.
- Iteration 3 slice: added the paired curated clang-manifest regression case for declaration type-start `<%` digraph coverage in struct-member declaration context (`struct S { <% member; };`), with explicit parse-stage message/position expectations and fixture checksum tracking.
- Iteration 3 slice: added a curated clang-manifest regression case for declaration type-start `:>` digraph coverage in struct-member declaration context (`struct S { :> member; };`), with explicit parse-stage message/position expectations and fixture checksum tracking.
- Iteration 3 slice: added curated clang-manifest regression coverage for hash-at-line-start member declarations (`struct S { # member; };`) as a preprocessor-stage failure (`Unknown preprocessor directive: #member`), with explicit stage/message/position expectations and fixture checksum tracking.
- Iteration 3 slice: added a curated clang-manifest regression case for declaration type-start `##` coverage in struct-member declaration context (`struct S { ## member; };`), with explicit parse-stage message/position expectations and fixture checksum tracking.
- Iteration 3 slice: added a curated clang-manifest regression case for declaration type-start `*` in struct-member declaration context (`struct S { * member; };`), with explicit parse-stage message/position expectations and fixture checksum tracking.
- Iteration 3 slice: added a curated clang-manifest regression case for declaration type-start `...` in struct-member declaration context (`struct S { ... member; };`), with explicit parse-stage message/position expectations and fixture checksum tracking.
- Iteration 3 slice: added a curated clang-manifest regression case for variadic declarator misuse (`int f(...);`) to lock down the parser diagnostic path `Expected parameter before ...` in the external clang fixture suite.
- Iteration 3 slice: added the sibling curated clang-manifest regression case for function-pointer variadic misuse (`int (*fp)(...);`) with explicit parse-stage message/position expectations and fixture checksum tracking.
- Iteration 3 slice: added a curated clang-manifest regression case for block-scope non-pointer variadic declarator misuse (`int main(){int f(...);return 0;}`) with explicit parse-stage message/position expectations and fixture checksum tracking.
- Iteration 3 slice: added a curated clang-manifest regression case for variadic declarator misuse in `for`-init declaration context (`int main(){for (int f(...);;){}}`) with explicit parse-stage message/position expectations and fixture checksum tracking.
- Checks: `uvx tox -e clang_suite -- -q` (pass).
- Iteration 3 slice: added a curated clang-manifest regression case for function-pointer variadic declarator misuse in `for`-init declaration context (`int main(){for (int (*fp)(...);;){}}`) with explicit parse-stage message/position expectations and fixture checksum tracking.
- Checks: `uvx tox -e clang_suite -- -q` (pass).
- Iteration 3 slice: added a curated clang-manifest regression case for function-pointer variadic declarator misuse in struct-member declaration context (`struct S { int (*fp)(...); };`) with explicit parse-stage message/position expectations and fixture checksum tracking.
- Checks: `uvx tox -e clang_suite -- -q` (pass).
- Iteration 3 slice: added a curated clang-manifest regression case for non-pointer variadic declarator misuse in struct-member declaration context (`struct S { int f(...); };`) with explicit parse-stage message/position expectations and fixture checksum tracking.
- Checks: `uvx tox -e clang_suite -- -q` (pass).
- Iteration 3 slice: added a sibling curated clang-manifest regression case for non-pointer variadic declarator misuse in union-member declaration context (`union U { int f(...); };`) with explicit parse-stage message/position expectations and fixture checksum tracking.
- Checks: `uvx tox -e clang_suite -- -q` (pass).
- Next target: add a curated clang-manifest regression case for variadic declarator misuse in typedef declaration context (`typedef int f(...);`) to lock down the same parser diagnostic path in typedef scope.
- Iteration 3 slice: added a curated clang-manifest regression case for function-pointer variadic declarator misuse in union-member declaration context (`union U { int (*fp)(...); };`), with explicit parse-stage message/position expectations and fixture checksum tracking.
- Checks: `uvx tox -e clang_suite -- -q` (pass).
- Iteration 3 slice: added a curated clang-manifest regression case for function-pointer variadic declarator misuse in typedef declaration context (`typedef int (*fp)(...);`), with explicit parse-stage message/position expectations and fixture checksum tracking.
- Checks: `uvx tox -e clang_suite -- -q` (pass).
- Next target: add a curated clang-manifest regression case for variadic declarator misuse in typedef declaration context inside block scope (`int main(){ typedef int f(...); return 0; }`) to lock down this parser diagnostic path in nested typedef scope.
- Iteration 3 slice: added a curated clang-manifest regression case for variadic declarator misuse in block-scope typedef declaration context (`int main(){ typedef int f(...); return 0; }`), with explicit parse-stage message/position expectations and fixture checksum tracking.
- Checks: `uvx tox -e clang_suite -- -q` (pass).
- Next target: add the sibling curated clang-manifest regression case for function-pointer variadic declarator misuse in block-scope typedef context (`int main(){ typedef int (*fp)(...); return 0; }`) to lock down the same parser diagnostic path for nested typedef function pointers.
- Iteration 3 slice: added a curated clang-manifest regression case for function-pointer variadic declarator misuse in block-scope typedef context (`int main(){ typedef int (*fp)(...); return 0; }`), with explicit parse-stage message/position expectations and fixture checksum tracking.
- Checks: `uvx tox -e clang_suite -- -q` (pass).
- Next target: add a focused parser unit regression (non-clang fixture) for function-pointer variadic misuse in block-scope typedef context so this diagnostic path is covered in both local parser tests and external clang fixtures.
- Iteration 3 slice: added a focused parser unit regression for typedef variadic declarator misuse at file scope (`typedef int f(...);`) and asserted the exact diagnostic (`Expected parameter before ...`) so this path is covered outside the external clang fixture suite.
- Checks: `.venv/bin/python -m unittest tests.test_parser.ParserTests.test_variadic_typedef_requires_fixed_parameter_at_file_scope tests.test_parser.ParserTests.test_variadic_typedef_function_pointer_requires_fixed_parameter_in_block_scope` (pass); `.venv/bin/python -m unittest tests.test_parser -q` (pass).
- Next target: add the sibling focused parser unit regression for file-scope function-pointer typedef variadic misuse (`typedef int (*fp)(...);`) to mirror existing clang-fixture coverage in local parser tests.
- Iteration 3 slice: tightened local parser regression for block-scope variadic function-pointer misuse (`int main(){int (*fp)(...);return 0;}`) by asserting the exact diagnostic message (`Expected parameter before ...`) instead of only checking that parsing fails.
- Checks: `.venv/bin/python -m unittest tests.test_parser.ParserTests.test_variadic_function_pointer_requires_fixed_parameter tests.test_parser.ParserTests.test_variadic_typedef_function_pointer_requires_fixed_parameter_at_file_scope` (pass); `.venv/bin/python -m unittest tests.test_parser -q` (pass).
- Next target: add a focused parser unit regression for non-typedef file-scope variadic function declarator misuse (`int f(...);`) with exact diagnostic assertion to mirror the existing clang fixture and strengthen local diagnostic stability coverage.
- Iteration 3 slice: added a focused parser unit regression for function-pointer variadic misuse in struct-member declaration context (`struct S { int (*fp)(...); };`) and asserted the exact diagnostic (`Expected parameter before ...`) so this parser path is now covered in local unit tests, not only clang fixtures.
- Checks: `.venv/bin/python -m unittest tests.test_parser.ParserTests.test_variadic_function_pointer_requires_fixed_parameter_in_struct_member tests.test_parser -q` (pass).
- Next target: add the sibling focused parser unit regression for non-pointer variadic misuse in struct-member declaration context (`struct S { int f(...); };`) with the same exact diagnostic assertion.
- Iteration 3 slice: added a focused parser unit regression for non-pointer variadic declarator misuse in `for`-init declaration context (`int main(){for (int f(...);;){} }`) and asserted the exact diagnostic (`Expected parameter before ...`), mirroring existing external clang fixture coverage in local parser tests.
- Checks: `.venv/bin/python -m unittest tests.test_parser.ParserTests.test_variadic_function_requires_fixed_parameter_in_for_init_declaration tests.test_parser.ParserTests.test_variadic_function_pointer_requires_fixed_parameter_in_for_init_declaration` (pass); `.venv/bin/python -m unittest tests.test_parser -q` (pass).
- Next target: add a focused parser unit regression for non-pointer variadic declarator misuse in block-scope declaration context (`int main(){int f(...);return 0;}`) with exact diagnostic assertion to mirror external clang fixture coverage locally.
- Iteration 3 slice: added a curated clang-manifest regression case for variadic declarator misuse in `for`-init typedef declaration context (`int main(){for (typedef int f(...);;){} }`), with explicit parse-stage message/position expectations and fixture checksum tracking.
- Checks: `uvx tox -e clang_suite -- -q` (pass).
- Next target: add the sibling curated clang-manifest regression case for function-pointer variadic declarator misuse in `for`-init typedef declaration context (`int main(){for (typedef int (*fp)(...);;){} }`) to lock down the same parser diagnostic path for typedef function pointers in `for`-init declarations.
- Iteration 3 slice: added a curated clang-manifest regression case for function-pointer variadic declarator misuse in `for`-init typedef declaration context (`int main(){for (typedef int (*fp)(...);;){} }`), with explicit parse-stage message/position expectations and fixture checksum tracking.
- Checks: `uvx tox -e clang_suite -- -q` (pass).
- Next target: add a focused local parser unit regression for function-pointer variadic declarator misuse in `for`-init typedef declaration context so this diagnostic path is covered in both local parser tests and external clang fixtures.
- Iteration 3 slice: added a focused local parser unit regression for non-pointer variadic declarator misuse in block-scope declaration context (`int main(){int f(...);return 0;}`) and asserted the exact diagnostic (`Expected parameter before ...`) so this parser path is now locked down in local tests.
- Checks: `.venv/bin/python -m unittest tests.test_parser.ParserTests.test_variadic_function_requires_fixed_parameter_in_block_scope tests.test_parser -q` (pass).
- Next target: add a focused local parser unit regression for non-pointer variadic declarator misuse in union-member context (`union U { int f(...); };`) to keep local parser coverage aligned with existing clang fixture diagnostics.
- Iteration 3 slice: mapped remaining unary punctuator type-start fallbacks for `++` and `--` in declaration/type-name contexts to explicit diagnostics (`Declaration type is missing before '++'/'--'...` and `Type name cannot start with '++'/'--'...`), and added focused local parser regression coverage for all four paths.
- Checks: `.venv/bin/python -m unittest tests.test_parser.ParserTests.test_unsupported_declaration_type_punctuator_reports_increment_message tests.test_parser.ParserTests.test_unsupported_declaration_type_punctuator_reports_decrement_message tests.test_parser.ParserTests.test_unsupported_type_name_punctuator_reports_increment_message tests.test_parser.ParserTests.test_unsupported_type_name_punctuator_reports_decrement_message` (pass); `.venv/bin/python -m unittest tests.test_parser -q` (pass).
- Iteration 3 slice: added curated clang-manifest regression cases for declaration/type-name type-start `++` and `--` punctuator diagnostics (`int f(++);`, `int f(--);`, and malformed `_Generic` associations with `++`/`--`), with explicit parse-stage message/position expectations and fixture checksum tracking.
- Checks: `uvx tox -e clang_suite -- -q` (pass).
- Next target: add a focused local parser unit regression for non-pointer variadic declarator misuse in union-member context (`union U { int f(...); };`) to keep local parser coverage aligned with existing clang fixture diagnostics.
- Iteration 3 slice: mapped type-name punctuator fallback for `...` to an explicit diagnostic (`Type name cannot start with ...: expected a type specifier`), and added both a focused local parser regression and a curated clang-manifest fixture for malformed `_Generic` associations with checksum tracking.
- Checks: `.venv/bin/python -m unittest tests.test_parser.ParserTests.test_unsupported_type_name_punctuator_reports_ellipsis_message tests.test_parser -q` (pass); `uvx tox -e clang_suite -- -q` (pass).
- Next target: add the sibling declaration-context coverage for `...` in malformed declaration starts inside `_Static_assert`/type-name-adjacent parser paths to keep punctuator diagnostics consistent across declaration/type-name entry points.
- Iteration 3 slice: replaced the generic expression-start fallback (`Unexpected token`) for ellipsis with a dedicated parser diagnostic (`Expression cannot start with '...': expected an operand`) and added both a focused local parser regression and a curated clang-manifest fixture for block-scope `_Static_assert`-adjacent usage.
- Checks: `.venv/bin/python -m unittest tests.test_parser.ParserTests.test_expression_start_ellipsis_after_static_assert_reports_operand_diagnostic tests.test_parser -q` (pass); `.venv/bin/python -m unittest tests.test_clang_suite.ClangSuiteTests.test_clang_manifest_case_schema tests.test_clang_suite.ClangSuiteTests.test_clang_fixtures_match_manifest_checksums -q` (pass).
- Note: `uvx tox -e clang_suite -- -q` is currently blocked by an unrelated preprocessor runtime failure in the dirty workspace (`NameError: _format_date_macro` from `src/xcc/preprocessor.py`) before parser fixtures execute.
- Next target: add the sibling expression-entry diagnostics for other punctuation-only operand starts that still funnel through generic `Unexpected token` in `_parse_primary` (for example `]`/`}`) with focused parser regressions.
- Iteration 3 slice: fixed preprocessor translation-time macro support by defining `__DATE__`/`__TIME__` as concrete string macros at translation start, restoring runtime stability and macro-table visibility while keeping `__FILE__`/`__LINE__` as location-dependent dynamic macros.
- Checks: `.venv/bin/python -m unittest tests.test_preprocessor.PreprocessorTests.test_predefined_date_and_time_macros_use_translation_start_time tests.test_preprocessor -q` (pass).
- Next target: resume parser diagnostic hardening by adding focused `_parse_primary` regressions for punctuation-only operand starts (`]`/`}`) that still report generic `Unexpected token`.
- Iteration 3 slice: replaced `_parse_primary` generic `Unexpected token` fallbacks for punctuation-only expression starts `]` and `}` with explicit operand diagnostics (`Expression cannot start with ']': expected an operand` / `Expression cannot start with '}': expected an operand`) and added focused parser regression coverage in block-scope `_Static_assert`-adjacent contexts.
- Checks: `.venv/bin/python -m unittest tests.test_parser.ParserTests.test_expression_start_right_bracket_reports_operand_diagnostic tests.test_parser.ParserTests.test_expression_start_right_brace_reports_operand_diagnostic tests.test_parser -q` (pass).
- Next target: add sibling `_parse_primary` expression-start diagnostics for additional punctuation-only operands that still report generic `Unexpected token` (for example `)`), with focused parser regressions mirroring statement-adjacent entry points.
- Iteration 3 slice: replaced `_parse_primary` generic `Unexpected token` fallbacks for delimiter-led expression starts (`)`, `,`, `:`) and `}` with explicit operand diagnostics, and added focused parser regression coverage for statement-adjacent entry points.
- Checks: `.venv/bin/python -m unittest tests.test_parser.ParserTests.test_expression_start_right_paren_reports_operand_diagnostic tests.test_parser.ParserTests.test_expression_start_comma_reports_operand_diagnostic tests.test_parser.ParserTests.test_expression_start_colon_reports_operand_diagnostic tests.test_parser.ParserTests.test_expression_start_right_brace_reports_operand_diagnostic tests.test_parser -q` (pass).
- Next target: add sibling `_parse_primary` expression-start diagnostics for additional punctuation-only operands still using generic `Unexpected token` (for example `?`), with focused parser regressions for statement-adjacent entry points.
- Iteration 3 slice: replaced `_parse_primary` generic `Unexpected token` fallbacks for expression starts `?`, `;`, and `{` with explicit operand diagnostics (`Expression cannot start with '?'/';'/'{': expected an operand`), and added focused parser regressions that cover each entry path in expression-required contexts.
- Checks: `.venv/bin/python -m unittest tests.test_parser.ParserTests.test_expression_start_question_reports_operand_diagnostic tests.test_parser.ParserTests.test_expression_start_semicolon_reports_operand_diagnostic tests.test_parser.ParserTests.test_expression_start_left_brace_reports_operand_diagnostic tests.test_parser -q` (pass).
- Next target: extend `_parse_primary` punctuation-start operand diagnostics for remaining operator-only punctuators that still fall through to generic `Unexpected token` (for example `%>` digraph or `##`), with both focused local parser regressions and curated clang-manifest fixtures where parser-stage coverage is reachable.
- Iteration 3 slice: replaced `_parse_primary` generic `Unexpected token` fallbacks for hash/digraph punctuation-led expression starts (`##`, `%:`, `%:%:`, `<:`, `:>`, `<%`, `%>`) with explicit operand diagnostics (`Expression cannot start with '<token>': expected an operand`), keeping parser behavior unchanged while hardening message specificity.
- Checks: `.venv/bin/python -m unittest tests.test_parser.ParserTests.test_expression_start_token_paste_reports_operand_diagnostic tests.test_parser.ParserTests.test_expression_start_hash_digraph_reports_operand_diagnostic tests.test_parser.ParserTests.test_expression_start_hash_hash_digraph_reports_operand_diagnostic tests.test_parser.ParserTests.test_expression_start_right_brace_digraph_reports_operand_diagnostic` (pass); `.venv/bin/python -m unittest tests.test_parser -q` (pass).
- Next target: add focused local parser regressions for the newly-mapped `<:` / `:>` / `<%` digraph expression-start diagnostics to lock down all delimiter-digraph operand-entry paths explicitly.
- Iteration 3 slice: added focused local parser regressions for expression-start diagnostics on `<:`, `:>`, and `<%`, so all delimiter digraph operand-entry paths now assert exact `Expression cannot start with ...` messages in parser unit tests.
- Checks: `.venv/bin/python -m unittest tests.test_parser.ParserTests.test_expression_start_left_bracket_digraph_reports_operand_diagnostic tests.test_parser.ParserTests.test_expression_start_right_bracket_digraph_reports_operand_diagnostic tests.test_parser.ParserTests.test_expression_start_left_brace_digraph_reports_operand_diagnostic tests.test_parser -q` (pass).
- Next target: add curated clang-manifest fixtures for expression-start digraph operand diagnostics (`<:`, `:>`, `<%`, `%>`) in statement-adjacent contexts so external conformance coverage mirrors local parser-unit coverage.
- Iteration 3 slice: added curated clang-manifest regression fixtures for statement-adjacent expression-start digraph diagnostics after `_Static_assert` (`<:`, `:>`, `<%`, `%>`), including explicit parse-stage message/position expectations and fixture checksum tracking.
- Checks: `.venv/bin/python -m unittest tests.test_parser.ParserTests.test_expression_start_left_bracket_digraph_reports_operand_diagnostic tests.test_parser.ParserTests.test_expression_start_right_bracket_digraph_reports_operand_diagnostic tests.test_parser.ParserTests.test_expression_start_left_brace_digraph_reports_operand_diagnostic tests.test_parser.ParserTests.test_expression_start_right_brace_digraph_reports_operand_diagnostic -q` (pass); `.venv/bin/python -m unittest tests.test_clang_suite.ClangSuiteTests.test_clang_manifest_case_schema tests.test_clang_suite.ClangSuiteTests.test_clang_fixtures_match_manifest_checksums -q` (pass).
- Note: `uvx tox -e clang_suite -- -q` still fails due pre-existing unrelated clang-suite baseline mismatches in this workspace (e.g. lexer stage/comment handling and many pre-existing manifest line/column expectation drifts), not caused by this slice.
- Next target: add sibling curated clang-manifest fixtures for expression-start hash/digraph operator tokens (`##`, `%:`, `%:%:`) in statement-adjacent contexts so external coverage matches existing local parser diagnostic regressions.
- Iteration 3 slice: added curated clang-manifest regression fixtures for statement-adjacent expression-start hash/digraph operator diagnostics after `_Static_assert` (`##`, `%:`, `%:%:`), including explicit parse-stage message/position expectations and fixture checksum tracking.
- Checks: `.venv/bin/python -m unittest tests.test_parser.ParserTests.test_expression_start_token_paste_reports_operand_diagnostic tests.test_parser.ParserTests.test_expression_start_hash_digraph_reports_operand_diagnostic tests.test_parser.ParserTests.test_expression_start_hash_hash_digraph_reports_operand_diagnostic -q` (pass); `.venv/bin/python -m unittest tests.test_clang_suite.ClangSuiteTests.test_clang_manifest_case_schema tests.test_clang_suite.ClangSuiteTests.test_clang_fixtures_match_manifest_checksums -q` (pass).
- Next target: add focused local parser regressions for remaining punctuation-led expression-start operand diagnostics that still rely on generic `Unexpected token` in non-`_Static_assert` entry paths (if any), then mirror newly covered paths into curated clang fixtures.
- Iteration 3 slice: tightened parser parameter-list diagnostics by rejecting trailing commas (`Expected parameter after ','`) and non-terminal ellipsis usage (`Expected ')' after ... in parameter list`) in both regular function declarations/definitions and function-suffix declarators (e.g. typedef function pointers).
- Checks: `.venv/bin/python -m unittest tests.test_parser.ParserTests.test_parameter_list_rejects_trailing_comma tests.test_parser.ParserTests.test_parameter_list_rejects_non_terminal_ellipsis tests.test_parser.ParserTests.test_function_suffix_parameter_list_rejects_trailing_comma tests.test_parser.ParserTests.test_function_suffix_parameter_list_rejects_non_terminal_ellipsis -q` (pass); `.venv/bin/python -m unittest tests.test_parser -q` (pass).
- Iteration 3 slice: added curated clang-manifest parser fixtures for trailing-comma and non-terminal-ellipsis parameter-list diagnostics in both direct function declarators and typedef function-pointer declarators, with explicit parse-stage message/position expectations and fixture checksum tracking.
- Checks: `.venv/bin/python -m unittest tests.test_parser.ParserTests.test_parameter_list_rejects_trailing_comma tests.test_parser.ParserTests.test_parameter_list_rejects_non_terminal_ellipsis tests.test_parser.ParserTests.test_function_suffix_parameter_list_rejects_trailing_comma tests.test_parser.ParserTests.test_function_suffix_parameter_list_rejects_non_terminal_ellipsis -q` (pass); `.venv/bin/python -m unittest tests.test_clang_suite.ClangSuiteTests.test_clang_manifest_case_schema tests.test_clang_suite.ClangSuiteTests.test_clang_fixtures_match_manifest_checksums -q` (pass).
- Next target: add focused local parser regressions for trailing-comma and non-terminal-ellipsis parameter-list diagnostics in block-scope and struct/union-member declaration contexts so diagnostic stability is locked down beyond file-scope and typedef declarators.
- Iteration 3 slice: added focused local parser regressions for trailing-comma and non-terminal-ellipsis parameter-list diagnostics in block-scope declarations and struct/union-member declaration contexts, asserting exact diagnostics for each context (`Expected parameter after ','` / `Expected ')' after ... in parameter list`).
- Iteration 3 slice: added matching curated clang-manifest fixtures for the same block-scope and struct/union-member parameter-list diagnostic paths, with explicit parse-stage line/column expectations and fixture checksum tracking.
- Checks: `.venv/bin/python -m unittest tests.test_parser.ParserTests.test_block_scope_parameter_list_rejects_trailing_comma tests.test_parser.ParserTests.test_block_scope_parameter_list_rejects_non_terminal_ellipsis tests.test_parser.ParserTests.test_struct_member_parameter_list_rejects_trailing_comma tests.test_parser.ParserTests.test_struct_member_parameter_list_rejects_non_terminal_ellipsis tests.test_parser.ParserTests.test_union_member_parameter_list_rejects_trailing_comma tests.test_parser.ParserTests.test_union_member_parameter_list_rejects_non_terminal_ellipsis -q` (pass); `.venv/bin/python -m unittest tests.test_clang_suite.ClangSuiteTests.test_clang_manifest_case_schema tests.test_clang_suite.ClangSuiteTests.test_clang_fixtures_match_manifest_checksums -q` (pass).
- Iteration 3 slice: added focused local parser regressions for trailing-comma and non-terminal-ellipsis parameter-list diagnostics in non-typedef function-pointer declarators across block scope and struct/union-member declaration contexts, asserting the exact diagnostics (`Expected parameter after ','` / `Expected ')' after ... in parameter list`) for each nested-scope path.
- Checks: `.venv/bin/python -m unittest tests.test_parser.ParserTests.test_block_scope_function_pointer_parameter_list_rejects_trailing_comma tests.test_parser.ParserTests.test_block_scope_function_pointer_parameter_list_rejects_non_terminal_ellipsis tests.test_parser.ParserTests.test_struct_member_function_pointer_parameter_list_rejects_trailing_comma tests.test_parser.ParserTests.test_struct_member_function_pointer_parameter_list_rejects_non_terminal_ellipsis tests.test_parser.ParserTests.test_union_member_function_pointer_parameter_list_rejects_trailing_comma tests.test_parser.ParserTests.test_union_member_function_pointer_parameter_list_rejects_non_terminal_ellipsis -q` (pass); `.venv/bin/python -m unittest tests.test_parser -q` (pass).
- Iteration 3 slice: added sibling curated clang-manifest fixtures for non-typedef function-pointer parameter-list diagnostics across block-scope and struct/union-member declaration contexts (trailing comma and non-terminal ellipsis), with explicit parse-stage message/position expectations and fixture checksum tracking.
- Checks: `.venv/bin/python -m unittest tests.test_clang_suite.ClangSuiteTests.test_clang_manifest_case_schema tests.test_clang_suite.ClangSuiteTests.test_clang_fixtures_match_manifest_checksums -q` (pass).
- Next target: audit `_parse_primary` and declaration-expression entry paths for any remaining punctuation-led generic `Unexpected token` diagnostics, then add focused local parser regressions plus curated clang fixtures for each uncovered token.
- Iteration 3 slice: added curated clang-manifest regression fixtures for the remaining bracket/brace expression-start operand diagnostics after `_Static_assert` (`]` and `}`), with explicit parse-stage message/position expectations and fixture checksum tracking.
- Checks: `.venv/bin/python -m unittest tests.test_parser.ParserTests.test_expression_start_right_bracket_reports_operand_diagnostic tests.test_parser.ParserTests.test_expression_start_right_brace_reports_operand_diagnostic tests.test_clang_suite.ClangSuiteTests.test_clang_manifest_case_schema tests.test_clang_suite.ClangSuiteTests.test_clang_fixtures_match_manifest_checksums -q` (pass).
- Next target: add sibling curated clang-manifest fixtures for other existing non-digraph delimiter expression-start operand diagnostics (`)` / `,` / `:` / `?` / `;` / `{`) so external fixture coverage fully mirrors the local parser regression set.
- Iteration 3 slice: added curated clang-manifest regression fixtures for statement-adjacent non-digraph delimiter expression-start diagnostics after `_Static_assert` (`)`, `,`, `:`, `?`, `;`, `{`), each with explicit parse-stage message/position expectations and fixture checksum tracking.
- Checks: `.venv/bin/python -m unittest tests.test_clang_suite.ClangSuiteTests.test_clang_manifest_case_schema tests.test_clang_suite.ClangSuiteTests.test_clang_fixtures_match_manifest_checksums -q` (pass).
- Next target: add focused local parser regressions for any remaining non-`_Static_assert` expression-entry paths that still emit generic punctuation-led `Unexpected token` diagnostics, then mirror any uncovered paths into curated clang fixtures.
- Iteration 3 slice: replaced `_parse_primary` keyword-led generic fallback diagnostics with an explicit operand message (`Expression cannot start with keyword '<kw>': expected an operand`) and added focused parser regression coverage for keyword-led expression starts.
- Iteration 3 slice: updated the curated clang manifest expectation for `C/C23/n2927_2.c` to assert the new keyword-led expression diagnostic text, keeping external fixture coverage aligned with local parser behavior.
- Checks: `.venv/bin/python -m unittest tests.test_parser.ParserTests.test_expression_start_keyword_reports_operand_diagnostic tests.test_clang_suite.ClangSuiteTests.test_clang_manifest_case_schema tests.test_clang_suite.ClangSuiteTests.test_clang_fixtures_match_manifest_checksums -q` (pass).
- Next target: audit non-keyword token kinds that can still hit `_parse_primary`'s generic `Unexpected token` fallback (for example end-of-input and malformed literal categories), then decide whether each path should get a dedicated diagnostic with local regression coverage.
- Iteration 3 slice: replaced `_parse_primary` EOF fallback diagnostics with an explicit expression-missing message (`Expression is missing before end of input`) and added focused local parser regressions for both return-expression and initializer-expression entry paths.
- Checks: `.venv/bin/python -m unittest tests.test_parser.ParserTests.test_expression_start_eof_after_return_reports_operand_diagnostic tests.test_parser.ParserTests.test_expression_start_eof_after_initializer_reports_operand_diagnostic tests.test_parser -q` (pass).
- Next target: audit remaining non-punctuator/non-keyword `_parse_primary` fallback paths (if any) and decide whether they need dedicated diagnostics or should remain as generic parser failures.
- Iteration 3 slice: aligned type-name digraph diagnostics with declaration-context token preservation by reporting `%>` explicitly (`Type name is missing before '%>'`) instead of canonicalizing to `}` in `_Generic` type-name parse failures.
- Checks: `.venv/bin/python -m unittest tests.test_parser.ParserTests.test_unsupported_type_name_punctuator_reports_right_brace_digraph_message tests.test_clang_suite.ClangSuiteTests.test_clang_manifest_case_schema tests.test_clang_suite.ClangSuiteTests.test_clang_fixtures_match_manifest_checksums -q` (pass).
- Next target: audit other type-name digraph canonicalization paths for mixed token-vs-canonical spelling in diagnostics and normalize them where consistency still drifts.
- Iteration 3 slice: expanded preprocessor include regression coverage for search precedence and mapping behavior by asserting that quoted includes prefer the source directory while angle includes resolve via configured include paths, plus include-expansion line-map provenance across header and main translation-unit lines.
- Iteration 3 slice: normalized include-not-found diagnostics to preserve directive delimiters (`"..."` vs `<...>`), and added explicit regression checks for both missing quoted and missing angle includes.
- Checks: `python3.11 -m unittest tests.test_preprocessor.PreprocessorTests.test_include_quoted_prefers_source_directory_over_include_path tests.test_preprocessor.PreprocessorTests.test_include_angle_skips_source_directory_and_uses_include_path tests.test_preprocessor.PreprocessorTests.test_include_expansion_preserves_line_map_for_header_source tests.test_preprocessor.PreprocessorTests.test_include_not_found tests.test_preprocessor.PreprocessorTests.test_include_not_found_for_angle_include_reports_delimiters -v` (pass).
- Note: full `tests.test_preprocessor` and `tox -e py311` remain red in this workspace due pre-existing baseline/environment issues unrelated to this slice (e.g. spacing-sensitive expected outputs and missing `coverage` executable inside tox py311 env).
- Iteration 3 slice: replaced `_parse_primary` generic non-punctuator fallback handling for preprocessor-only token kinds with explicit operand diagnostics for preprocessing numbers and header names (`Expression cannot start with preprocessing number...` / `Expression cannot start with header name...`), reducing another opaque `Unexpected token` path.
- Iteration 3 slice: added focused local parser regressions that inject `PP_NUMBER` and `HEADER_NAME` tokens at expression entry to lock down these diagnostics even though translation lexing does not normally emit these token kinds.
- Checks: `.venv/bin/python -m unittest tests.test_parser.ParserTests.test_expression_start_pp_number_reports_operand_diagnostic tests.test_parser.ParserTests.test_expression_start_header_name_reports_operand_diagnostic tests.test_parser -q` (pass).
- Next target: decide whether `_parse_primary` should keep a final generic fallback for truly unreachable token-kind combinations or move to a token-kind-aware internal error diagnostic with dedicated parser coverage.
- Iteration 3 slice: replaced `_parse_primary`'s final generic `Unexpected token` fallback with a token-kind-aware diagnostic (`Expression cannot start with unsupported token kind ...`) that includes the unexpected kind name and lexeme hint to make impossible/internal token-path failures actionable.
- Iteration 3 slice: added focused local parser regression coverage that injects a synthetic non-`TokenKind` token kind at expression entry and asserts the exact new fallback diagnostic text.
- Checks: `.venv/bin/python -m unittest tests.test_parser.ParserTests.test_expression_start_unsupported_token_kind_reports_specific_diagnostic tests.test_parser -q` (pass).
- Next target: audit other parser generic fallback sites outside `_parse_primary` for similarly opaque diagnostics and apply token-aware message upgrades where fallback paths are still reachable.
- Iteration 3 slice: tightened type-name parse diagnostics by rejecting named declarators in parenthesized type-name contexts (cast and `_Atomic(type-name)`) with an explicit identifier-bearing message (`Type name cannot declare identifier '<name>'`) instead of the opaque `Expected type name` fallback.
- Iteration 3 slice: added focused local parser regressions for both cast and `_Atomic(type-name)` paths to lock down this diagnostic shape.
- Checks: `.venv/bin/python -m unittest tests.test_parser.ParserTests.test_type_name_cannot_declare_identifier_in_cast tests.test_parser.ParserTests.test_type_name_cannot_declare_identifier_in_atomic_type_specifier tests.test_parser -q` (pass).
- Next target: audit remaining parser `Expected identifier` / `Expected type name` diagnostics to identify other contexts where including the offending token/identifier would improve actionability without changing parse behavior.

- Iteration 3 slice: upgraded parser missing-declarator diagnostics to include the blocking token text (`Expected identifier before '<token>'`) and EOF-specific wording (`Expected identifier before end of input`) instead of the opaque generic `Expected identifier`, improving actionability across declaration, record-member, and declarator entry paths.
- Iteration 3 slice: added focused local parser regressions for missing declarators in file-scope declarations and comma-led declarator lists, and updated the existing record-member missing-declarator assertion to the new token-aware diagnostic.
- Checks: `.venv/bin/python -m unittest tests.test_parser.ParserTests.test_record_member_rejects_missing_declarator tests.test_parser.ParserTests.test_file_scope_declaration_rejects_missing_declarator_with_token tests.test_parser.ParserTests.test_declarator_rejects_missing_identifier_before_comma -q` (pass); `.venv/bin/python -m unittest tests.test_parser -q` (pass).
- Next target: audit remaining `Expected type name` diagnostics for contexts where token-aware wording can improve parser actionability without altering accepted grammar.
- Iteration 3 slice: replaced `_parse_type_name`'s remaining opaque `Expected type name` fallback with an identifier-aware diagnostic (`Type name cannot declare identifier '<name>'`) when `_Generic`/type-name contexts incorrectly declare names.
- Iteration 3 slice: added focused local parser regression coverage for named declarators in `_Generic` associations to lock down this diagnostic outside cast and `_Atomic(type-name)` contexts.
- Checks: `.venv/bin/python -m unittest tests.test_parser.ParserTests.test_type_name_cannot_declare_identifier_in_generic_association tests.test_parser.ParserTests.test_type_name_cannot_declare_identifier_in_cast tests.test_parser.ParserTests.test_type_name_cannot_declare_identifier_in_atomic_type_specifier tests.test_parser -q` (pass).
- Next target: audit remaining generic parser fallback diagnostics outside type-name/declarator paths and continue replacing them with token-aware messages plus focused regressions.
- Iteration 3 slice: upgraded parser `Invalid declaration specifier` diagnostics in parameter, record-member, and typedef contexts to include both the declaration context and offending specifier keyword (`_Thread_local`/`inline`/`_Noreturn`) for more actionable parse failures.
- Iteration 3 slice: added focused parser regression assertions for the updated context-aware invalid-specifier diagnostics in parameter, record-member, and typedef declarations.
- Checks: `.venv/bin/python -m unittest tests.test_parser.ParserTests.test_parameter_rejects_thread_local_specifier tests.test_parser.ParserTests.test_record_member_rejects_function_specifier tests.test_parser.ParserTests.test_typedef_rejects_function_specifier -q` (pass); `.venv/bin/python -m unittest tests.test_parser -q` (pass).
- Next target: apply the same context-aware diagnostic pattern to remaining generic parser `Invalid * specifier` errors (for example storage-class/alignment contexts) where the offending keyword can be surfaced without grammar changes.
- Iteration 3 slice: upgraded parser alignment-context diagnostics to report where `_Alignas` is invalid (`function declaration`, `typedef declaration`, `parameter`, `tag-only declaration`, and `record member declaration`) instead of using the opaque generic `Invalid alignment specifier` in those contexts.
- Iteration 3 slice: updated focused parser regression assertions for all affected `_Alignas` rejection paths to lock down the new context-aware messages while keeping `_Alignas(...)` value-validation diagnostics unchanged.
- Checks: `.venv/bin/python -m unittest tests.test_parser.ParserTests.test_alignas_rejects_function_definition tests.test_parser.ParserTests.test_alignas_rejects_function_declaration tests.test_parser.ParserTests.test_alignas_rejects_typedef_declaration tests.test_parser.ParserTests.test_alignas_rejects_parameter_declaration tests.test_parser.ParserTests.test_alignas_rejects_file_scope_tag_only_declaration tests.test_parser.ParserTests.test_alignas_rejects_block_scope_tag_only_declaration tests.test_parser.ParserTests.test_alignas_rejects_member_tag_only_declaration tests.test_parser.ParserTests.test_alignas_rejects_member_function_declaration -q` (pass); `.venv/bin/python -m unittest tests.test_parser -q` (pass).
- Iteration 3 slice: upgraded parameter storage-class diagnostics to include the offending keyword (`Invalid storage class for parameter: '<keyword>'`) and point at the exact storage-class token, replacing the previous generic message.
- Iteration 3 slice: added focused parser regression coverage for both `static` and `extern` parameter storage-class rejection paths with exact message assertions.
- Checks: `.venv/bin/python -m unittest tests.test_parser.ParserTests.test_parameter_rejects_non_register_storage_class tests.test_parser.ParserTests.test_parameter_rejects_extern_storage_class -q` (pass); `.venv/bin/python -m unittest tests.test_parser -q` (pass).
- Next target: audit remaining parser storage-class diagnostics outside parameter parsing (where applicable) for similar token-aware context upgrades without changing accepted grammar.
- Iteration 3 slice: upgraded sema storage-class diagnostics to include offending storage-class keywords for invalid function declarations, file-scope object declarations, and `_Thread_local` declarations with missing/invalid storage class (`none`) so failures are context-specific instead of generic.
- Iteration 3 slice: updated sema regression assertions for function/file-scope/thread-local storage-class rejection paths to lock down the new token-aware diagnostics.
- Checks: `.venv/bin/python -m unittest tests.test_sema.SemaTests.test_function_invalid_storage_class_error tests.test_sema.SemaTests.test_file_scope_invalid_storage_class_error tests.test_sema.SemaTests.test_invalid_thread_local_storage_class_error -q` (pass); `.venv/bin/python -m unittest tests.test_sema -q` (pass).
- Next target: apply the same token-aware diagnostic pattern to remaining sema storage-class rejections (for example object-declaration `typedef` paths) where parser-generated AST nodes can still hit generic wording.
- Iteration 3 slice: upgraded remaining sema storage-class diagnostics for object declarations by making file-scope and block-scope `typedef` object-declaration failures keyword-driven (`Invalid storage class for ... object declaration: '<keyword>'`) instead of hardcoded text, and by splitting `_Thread_local` failures into file-scope vs block-scope object-declaration contexts.
- Iteration 3 slice: added focused sema regression coverage for invalid file-scope `_Thread_local`+`auto` declarations and updated block-scope `_Thread_local` message assertions to the new context-specific wording.
- Checks: `.venv/bin/python -m unittest tests.test_sema.SemaTests.test_file_scope_object_declaration_rejects_typedef_storage_class tests.test_sema.SemaTests.test_block_scope_object_declaration_rejects_typedef_storage_class tests.test_sema.SemaTests.test_invalid_thread_local_storage_class_error tests.test_sema.SemaTests.test_file_scope_thread_local_rejects_invalid_storage_class -q` (pass); `.venv/bin/python -m unittest tests.test_sema -q` (pass).
- Next target: audit remaining sema diagnostics that still use context-ambiguous wording (`Expected identifier`, `Invalid alignment specifier`) in declaration-analysis paths and apply the same context-aware pattern where it improves actionability without changing semantics.
- Iteration 3 slice: upgraded sema alignment diagnostics in declaration analysis to include declaration context (`file-scope object declaration`, `block-scope object declaration`, `record member declaration`, and tag-only declaration paths without identifiers) instead of using the generic `Invalid alignment specifier` wording.
- Iteration 3 slice: updated focused sema regression assertions for file-scope/block-scope `_Alignas` object declarations, tag-only declarations, and record-member alignment failures to lock down the new context-aware diagnostics.
- Checks: `.venv/bin/python -m unittest tests.test_sema.SemaTests.test_alignas_rejects_weaker_alignment_than_type tests.test_sema.SemaTests.test_alignas_tag_only_declaration_error tests.test_sema.SemaTests.test_alignas_file_scope_weaker_alignment_error tests.test_sema.SemaTests.test_alignas_block_scope_tag_only_declaration_error tests.test_sema.SemaTests.test_alignas_rejects_member_weaker_than_natural_alignment -q` (pass); `.venv/bin/python -m unittest tests.test_sema -q` (pass).
- Next target: apply the same context-aware diagnostic pattern to remaining sema declaration-analysis fallbacks that still emit `Expected identifier` without scope/context detail.
- Iteration 3 slice: upgraded sema missing-identifier diagnostics for file-scope/block-scope object declarations to include triggering declaration qualifiers (`storage class '<keyword>'` and/or `'_Thread_local'`) instead of a generic context-only `Expected identifier` message.
- Iteration 3 slice: added focused sema regression coverage for missing identifiers in file-scope `_Thread_local` declarations and block-scope `extern` / `_Thread_local` declarations, and updated the existing file-scope `static` assertion to the new qualifier-aware wording.
- Checks: `.venv/bin/python -m unittest tests.test_sema.SemaTests.test_file_scope_storage_without_identifier_error tests.test_sema.SemaTests.test_file_scope_thread_local_without_identifier_error tests.test_sema.SemaTests.test_block_scope_storage_without_identifier_error tests.test_sema.SemaTests.test_block_scope_thread_local_without_identifier_error -q` (pass); `.venv/bin/python -m unittest tests.test_sema -q` (pass).
- Next target: audit remaining sema declaration-analysis diagnostics for similar qualifier-loss patterns (for example object-type or linkage-related rejections) and surface the triggering keyword/context where it improves actionability without changing semantics.
- Iteration 3 slice: upgraded sema extern-initializer rejection diagnostics to preserve declaration context by splitting file-scope vs block-scope object-declaration errors (`Invalid initializer for <scope> object declaration with storage class 'extern'`) instead of the generic `Extern declaration cannot have initializer` fallback.
- Iteration 3 slice: updated focused sema regression assertions for both block-scope and file-scope extern initializer rejection paths to lock down the new context-aware wording.
- Checks: `.venv/bin/python -m unittest tests.test_sema.SemaTests.test_extern_initializer_error tests.test_sema.SemaTests.test_file_scope_extern_initializer_error -q` (pass); `.venv/bin/python -m unittest tests.test_sema -q` (pass).
- Iteration 3 slice: upgraded sema object-type rejection diagnostics in declaration analysis to include declaration scope context (`Invalid object type for file-scope object declaration: ...` / `Invalid object type for block-scope object declaration: ...`) for atomic/void/incomplete object-type failures, while keeping compound-literal expression diagnostics unchanged.
- Iteration 3 slice: updated focused sema regression assertions for file-scope and block-scope object-type rejection paths (atomic, void, and incomplete records) to lock down the new context-aware wording.
- Checks: `.venv/bin/python -m unittest tests.test_sema.SemaTests.test_atomic_incomplete_record_pointer_error tests.test_sema.SemaTests.test_atomic_function_object_file_scope_error tests.test_sema.SemaTests.test_atomic_function_object_block_scope_error tests.test_sema.SemaTests.test_file_scope_incomplete_object_error tests.test_sema.SemaTests.test_file_scope_void_object_error tests.test_sema.SemaTests.test_incomplete_struct_object_error tests.test_sema.SemaTests.test_incomplete_union_object_error tests.test_sema.SemaTests.test_incomplete_anonymous_record_object_error tests.test_sema.SemaTests.test_invalid_object_type_void -q` (pass); `.venv/bin/python -m unittest tests.test_sema -q` (pass).
- Next target: audit sema object-type diagnostics in non-declaration contexts (e.g. compound literals) and decide whether context qualifiers should be surfaced there too without regressing concise expression-level errors.
- Iteration 3 slice: upgraded compound-literal invalid object-type diagnostics to include expression context (`Invalid object type for compound literal: ...`) and aligned all invalid object categories (atomic, void, incomplete record) behind a shared object-type label helper.
- Iteration 3 slice: added focused sema regression coverage for invalid compound-literal object types across `void`, incomplete record, and `_Atomic(void)` cases to lock down the new context-aware wording.
- Checks: `.venv/bin/python -m unittest tests.test_sema.SemaTests.test_compound_literal_invalid_object_type_errors tests.test_sema.SemaTests.test_compound_literal_invalid_atomic_object_type_error -q` (pass); `.venv/bin/python -m unittest tests.test_sema -q` (pass).
- Next target: audit remaining sema non-declaration diagnostics for context loss (for example expression-level object-type and operand-constraint failures) and upgrade only the paths where added context improves actionability without making core messages noisy.
- Iteration 3 slice: upgraded `sizeof`/`_Alignof` expression diagnostics in sema from generic `Invalid ... operand` fallbacks to reason-specific messages (`void type`, `atomic type`, `incomplete type`, `function type`, GNU-only `_Alignof(expr)` usage, and unknown/unsupported type cases).
- Iteration 3 slice: preserved helper compatibility by retaining boolean invalid-operand predicates used by `_Generic` and integer-constant-expression evaluation while routing new diagnostics through reason helpers.
- Iteration 3 slice: updated focused sema regressions for `sizeof`/`_Alignof` invalid operand paths to assert exact reason-bearing diagnostics across type-specifier and expression forms.
- Checks: `.venv/bin/python -m unittest tests.test_sema.SemaTests.test_alignof_expression_rejected_in_c11 tests.test_sema.SemaTests.test_alignof_expression_rejected_in_c11_ast_path tests.test_sema.SemaTests.test_sizeof_void_type_error tests.test_sema.SemaTests.test_sizeof_atomic_void_type_error tests.test_sema.SemaTests.test_sizeof_incomplete_record_type_error tests.test_sema.SemaTests.test_sizeof_function_type_error tests.test_sema.SemaTests.test_sizeof_function_designator_error tests.test_sema.SemaTests.test_sizeof_void_expression_error tests.test_sema.SemaTests.test_sizeof_incomplete_record_expression_error tests.test_sema.SemaTests.test_alignof_void_type_error tests.test_sema.SemaTests.test_alignof_function_designator_error tests.test_sema.SemaTests.test_alignof_unknown_type_name_error tests.test_sema.SemaTests.test_alignof_unknown_expression_type_error -q` (pass); `.venv/bin/python -m unittest tests.test_sema -q` (pass).
- Next target: apply the same reason-specific diagnostic pattern to remaining generic expression-level sema fallbacks (for example cast/sizeof/alignof-adjacent invalid-type paths) where more context improves actionability without overlong errors.
